<!DOCTYPE html>
<html>
<head>
<meta content="yes" name="apple-mobile-web-app-capable">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>文件操作 File</title>
<script type="text/javascript" src="./JSFile.js"></script>
<style>
    body {
        font: 13px Helvetica, arial, freesans, clean, sans-serif;
        line-height: 1.4;
    }
    .ct {
        margin: 10px auto;
        border: 1px solid #999;
        padding: 5px 10px;
        -webkit-box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.5);
        -moz-box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.5);
        -o-box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.5);
        -ms-box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.5);
        box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.5);
    }
    ul, li {
        margin: 0;
        padding: 0;
        list-style: none;
    }
    li {
        margin: 10px;
    }
    li span {
        color: rgb(0, 128, 255);
    }
    .hover {
        background-color: rgba(0,0,0,.4);
    }
    #btes,#save {
        position: absolute;
        top: 30px;
        right: 30px;
        color: green;
    }
    #save {
        top: 5px;
        right: 5px;
    }
</style>
</head>
<body>
    <form action="/upload" method="POST">
        <input type="file" name="files[]" multiple="" id="fl">
    </form>
    <div id="imgs"></div>
    <div id="btes"></div>
    <div id="save"><textarea id="txt"></textarea><button id="sv">保存txt</button></div>
    <script type="text/javascript">
    (function(win, document) {
        var $ = function(id) {
            return document.getElementById(id);
        }
        var preview = $('imgs');
        var btes = $('btes');
        var txt = $('txt');
        $('sv').onclick = function() {
            JSFile.saveAsTxt(txt.value, '默认');
        }
        
        var up = JSFile.upload($('fl'), {
            onAdd: function(e, data) {
                JSFile.each(data.files, function(file) {
                    // var img = document.createElement("img");
                    // img.file = file;
                    // preview.appendChild(img);
                    // var reader = new FileReader();
                    // reader.onload = (function(aImg) { 
                    //     return function(e) { aImg.src = e.target.result; } 
                    // })(img);
                    // reader.readAsDataURL(file);
                    if (file.type.match(/^image\/.+$/i)) {
                        var img = new Image();
                        img.onload = function() {
                            window.URL.revokeObjectURL(this.src)
                        }
                        img.src = window.URL.createObjectURL(file);
                        preview.appendChild(img);
                    }
                    
                    var i = document.createElement('p');
                    i.innerHTML = '大小：' + file.size + 'bytes    ' + '名字：' + file.name;
                    preview.appendChild(i);
                });
            },

            onChange: function() {
                preview.innerHTML = ''
            },

            onDrop: function() {
                preview.innerHTML = ''
                document.body.className = ""
            },

            onDragEnter: function() {
                document.body.className = "hover"
            },
            onDragOver: function() {
                document.body.className = "hover"
            },
            onDragLeave: function() {
                document.body.className = ""
            },
            onPaster: function() {
                preview.innerHTML = ''
            },

            onProgress: function(e,data) {
                btes.innerHTML += ("<p>" + data._progress.loaded + " / " + data._progress.total +"</p>");
            }
        });

    })(window, document);
    </script>
</body>
</html>